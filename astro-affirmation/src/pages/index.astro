---
import Layout from "../layouts/Layout.astro";
import background from "../assets/background.svg";


const postImports = import.meta.glob("./posts/*.md");

const allPostNumbers = Object.keys(postImports)
  .map(filename => {
    const match = filename.match(/\.\/posts\/(\d+)\.md$/);
    return match ? parseInt(match[1]) : 0;
  })
  .filter(num => num > 0)
  .sort((a, b) => a - b);

const allPosts = await Promise.all(
  allPostNumbers.map(async (postNum) => {
    const filename = `./posts/${postNum}.md`;
    const mod = await postImports[filename]() as any;
    return {
      number: postNum,
      title: mod.frontmatter.title,
      content: mod.default,
      frontmatter: mod.frontmatter
    };
  })
);

const postsData = JSON.stringify(allPosts);
---

<Layout>
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: "Segoe UI", Roboto, sans-serif;
    }

    .page-container {
      position: relative;
      min-height: 100vh;
      overflow: hidden;
      background: linear-gradient(160deg, #a8dadc, #457b9d, #1d3557);
      opacity: 0.6;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
    }

    .content {
      position: relative;
      z-index: 1;
      color: #f1faee;
      max-width: 800px;
      line-height: 1.4;
      font-size: 2rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    #background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      filter: blur(100px);
    }

    @media (max-width: 600px) {
      .content {
        font-size: 1.5rem;
      }
    }

    .loading {
      opacity: 0.7;
    }
  </style>

  <div class="page-container">
    <div class="content" id="content">
      <img id="background" src={background.src} alt="" fetchpriority="high" />
      <h1 id="title">Loading...</h1>
      <div id="post-content" class="loading">Loading...</div>
    </div>
  </div>

  <script define:vars={{ postsData }}>
    const allPosts = JSON.parse(postsData);
    
    function showRandomPost() {
      const randomIndex = Math.floor(Math.random() * allPosts.length);
      const randomPost = allPosts[randomIndex];
      
      document.getElementById('title').textContent = randomPost.title;
      document.getElementById('post-content').innerHTML = randomPost.content;
    }
    
    showRandomPost();
  </script>
</Layout>
