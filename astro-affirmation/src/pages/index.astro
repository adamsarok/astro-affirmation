---
import Layout from "../layouts/Layout.astro";
import background from "../assets/background.svg";

// Import all markdown files in /posts
const postImports = import.meta.glob("./posts/*.md");

// Get the day number (same logic as before)
const dayNumber = new Date().getDate() - 1;

// Find the maximum post number available
const maxPostNumber = Math.max(
  ...Object.keys(postImports)
    .map(filename => {
      const match = filename.match(/\.\/posts\/(\d+)\.md$/);
      return match ? parseInt(match[1]) : 0;
    })
    .filter(num => num > 0)
);

// Wrap around if day number exceeds max post number
const adjustedDayNumber = dayNumber > maxPostNumber ? 
  ((dayNumber - 1) % maxPostNumber) + 1 : 
  dayNumber;

// Build the filename for today
const postFilename = `./posts/${adjustedDayNumber}.md`;

let post, frontmatter;
if (postImports[postFilename]) {
  const mod = await postImports[postFilename]() as any;
  post = mod.default;
  frontmatter = mod.frontmatter;
} else {
  post = null;
  frontmatter = { title: "No post found" };
}
---

<Layout>
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: "Segoe UI", Roboto, sans-serif;
    }

    .page-container {
      position: relative;
      min-height: 100vh;
      overflow: hidden;
      background: linear-gradient(160deg, #a8dadc, #457b9d, #1d3557);
      opacity: 0.6;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
    }

    .content {
      position: relative;
      z-index: 1;
      color: #f1faee;
      max-width: 800px;
      line-height: 1.4;
      font-size: 2rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    #background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      filter: blur(100px);
    }

    @media (max-width: 600px) {
      .content {
        font-size: 1.5rem;
      }
    }
  </style>

  <div class="page-container">
    <div class="content">
      <img id="background" src={background.src} alt="" fetchpriority="high" />
      <h1>{frontmatter.title}</h1>
      {post ? <post /> : <p>No post found for today.</p>}
    </div>
  </div>
</Layout>
